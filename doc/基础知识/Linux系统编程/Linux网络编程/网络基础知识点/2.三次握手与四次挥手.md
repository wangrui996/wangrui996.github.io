# 2.三次握手与四次挥手  

* TCP通信时序：三次握手四次挥手  

![image](https://user-images.githubusercontent.com/58176267/176338673-0ca2e370-7865-456e-bdaf-1f4ffa3f73ff.png)  


## 三次握手  

* 三次握手完成于内核：
    * 对于服务器：accept() 函数    
    * 对于客户端 connect()函数  
    * 用户从代码层面, 就是这两个函数分别成功执行并返回，就表示内核已经完成三次握手  
    
![image](https://user-images.githubusercontent.com/58176267/176338730-571d7109-65eb-4781-9d48-90eb8ec6ffb8.png)  


## TCP通信  



## 四次挥手  

* 四次挥手主要和 “半关闭状态”这个概念有关  
* 内核套接字的原理中，一端的套接字内部实际上有两个内核缓冲区,一个读一个写缓冲区  
* **所谓的半关闭，关闭的是内部的缓冲区**  
    * 比如客户端收到服务器的ACK后就进入半关闭状态, 就是客户端的写缓冲区，但还有读缓冲区，可以接受服务器接下来的数据  
    * 服务器在确认发送完数据后，发送FIN  客户端还是可以回复ACK的   客户端此时只是写缓冲区被“关闭”，并不是连接被关闭了，此时发送ACK应答数据是可以的只不过不带有数据而已  
    * 最后客户端发送完ACK后，不会立即关闭，而是等会，在此期间如果又收到了服务器端的FIN报文，会又继续发一次ACK


## TCP数据包格式  

## TCP滑动串口  



