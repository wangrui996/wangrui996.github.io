# uboot   


![image](https://user-images.githubusercontent.com/58176267/174925435-06722244-00f7-40a7-ace3-0d7152a22aff.png)


## 编译uboot  

* 这里以512MB DDR3 加 8GB eMMC核心板为例  
* ARCH 和 CROSS_COMPILE 为顶层MAKEFILE中的变量  
* mx6ull_14x14_ddr512_emmc_defconfig  是正点原子提供的默认配置文件   
* 执行第二条指令后，生成一个.config文件 使用 ls -a可以看到  
* 编译时  V=1 表示打印详细的编译过程  

![image](https://user-images.githubusercontent.com/58176267/174928911-bda63331-0174-4e26-a922-19e87cb5d4d8.png)  


![image](https://user-images.githubusercontent.com/58176267/174935655-6d17894c-6d12-4aee-97d5-63816ce19c65.png)  


* 在明确架构是arm和交叉编译器时，直接在Makefile文件设置好两个变量，之后使用make -j16 或者 make V=1 -j16编译即可  


## 使用sd卡启动  

* 为便于研究uboot，后序不再使用正点原子MFG_TOOL出厂固件烧录工具烧录，该工具目前会一并烧录内核，浪费较多时间  
* 将开发工具下，烧写裸机程序用的imxdownload复制到uboot编译目录下，添加可执行权限后 通过命令 ./imxdownload u-boot.bin /dev/sda 烧录到sd卡 开发板选择sd卡启动  
    * 注意，可通过 sudo fdisk -l 查看sd卡设备名  可能会有两个一个是/dev/sda一个是/dev/sda1  前者是设备名  后面是分区名
    * 拨码开关要拨到sd卡启动  
 
## uboot启动信息  

* Net网络 ： FEC1  

![image](https://user-images.githubusercontent.com/58176267/174962726-8c53042c-e523-4ce5-a814-133190072879.png)  

* mmc list  查看flash  
    * 一个是sd卡一个是emmc  
![image](https://user-images.githubusercontent.com/58176267/174962958-75fc4406-3e8f-4ef6-8f3d-0a6a3ecad60f.png)


## uboot命令  

* **help 或 ？**         打印uboot支持的命令  
* **help/？ + 命令名**  查看某一命令的帮助信息


### 信息查询相关  

* bdinfo  打印板子信息  
    * 0x80000000  DDR的起始地址  
    * 0x80000100   boot参数存放的地址  
    * DRAM bank  DRAM区块  
    * eth0name  网卡名字  默认uboot是支持网络的
    * ethaddr  网络地址没有设置  
 
![image](https://user-images.githubusercontent.com/58176267/174963565-4941c330-44d2-4241-87d1-beb4197cb2fd.png)  


* **printenv**  查看当前板子的环境变量  
    * 变量类型字符串  这些变量与环境有关  
    * 如波特率 网卡名  
    * 比较重要的是**bootcmd  和 bootargs**  

* **setenv**   设置环境变量  
    *  setenv bootdelay 5
    *  修改某一环境变量值后只是在代码中修改了，还没有保存到emmc  重启后会丢失  
    *  执行saveenv 保存 写入到emmc
    *  字符串变量值要用单引号引起来(字符串中间无空格的时候也可以不用单引号)  setenv bootcmd 'console=ttymxc0,115200 root=/dev/mmcblklp2 rootwait rw'  设置系统启动后是用的emmc的第二个分区  
    *  **setenv可以自定义环境变量， setenv 变量名 值
    *  删除环境变量 **setenv 变量名**


* **saveenv**   保存环境变量 
    * 使用该命令可以将默认的环境变量保存到板子EMMC特定位置   再重新启动就没有 *** Warning - bad CRC, using default environment提示了  


### 内存相关命令  

* 内存操作命令就是用于直接对 DRAM 进行读写操作的，常用的内存操作命令有 md、nm、mm、mw、cp 和 cmp  

### md查看内存值  

* **注意：内存中地址都是16进制** 这里要查看的字节数也是16进制形式  

![image](https://user-images.githubusercontent.com/58176267/174968029-43907f4f-19b7-4c8d-8cdb-5ba4e4da342c.png)  
![image](https://user-images.githubusercontent.com/58176267/174969385-b8d44ed6-615f-4dda-85b6-697eb23f37d7.png)  


### nm命令修改内存值  

![image](https://user-images.githubusercontent.com/58176267/174969756-dd4b239e-fc98-473d-bf5e-f0c58066851c.png)  

### mm命令 修改内存 连续的修改一段内存  

![image](https://user-images.githubusercontent.com/58176267/174970164-6cb45d55-0120-446e-bc13-f2fc3c48e057.png)  

### mw命令 使用指定的数据填充一段内存  

![image](https://user-images.githubusercontent.com/58176267/174970365-ea2f861b-c1ec-4ebc-bc1b-17195c348219.png)  

### cp命令  

* cp 是数据拷贝命令，用于将 DRAM 中的数据从一段内存拷贝到另一段内存中，或者把 Nor Flash 中的数据拷贝到 DRAM 中  

![image](https://user-images.githubusercontent.com/58176267/174970613-83f0803a-4ded-4452-a2c4-e7280b6978b9.png)  

### cmp命令  

![image](https://user-images.githubusercontent.com/58176267/174970828-48b87678-0aac-482c-a7e4-7ec7420800ff.png)  


## 网络相关命令  

![image](https://user-images.githubusercontent.com/58176267/174974040-21272cad-944b-4b2a-9828-b199b67f8f18.png)


### ping  



### dhcp  
    * 自动获取IP地址

![image](https://user-images.githubusercontent.com/58176267/174973945-7b1de029-11f0-42d7-9396-7aadef79ccce.png)


### nfs 命令  

* 网络文件系统  

![image](https://user-images.githubusercontent.com/58176267/174974717-6f083ead-8568-44f0-b765-6a03becca450.png)  

![image](https://user-images.githubusercontent.com/58176267/174975802-82dfaa99-7a50-4b69-ad58-f708ec8a624e.png)  


* **Linux网络下载镜像时“nfs报错：ERROR: File lookup fail”解决方法(https://blog.csdn.net/qq_35333978/article/details/107288293)**
  
































