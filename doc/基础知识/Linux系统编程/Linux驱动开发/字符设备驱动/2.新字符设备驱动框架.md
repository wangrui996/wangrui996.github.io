# 2.新字符设备驱动框架  

* 老的字符设备驱动框架缺点：
    * 使用 register_chrdev 函数注册，需要传入主设备号和设备名，需要自己查当前系统没有使用的设备号，且一个主设备号，会浪费其对应的次设备号  



## 新字符设备驱动框架  


## alloc_chrdev_region 函数 注册设备

* 定义在内核源文件的 char_dev.c 中  

```c
int alloc_chrdev_region(dev_t *dev, unsigned baseminor, unsigned count, const char *name)
```

* 参数：
    * dev： dev_t类型的指针，也就是需要定义一个设备号类型dev_t，然后取地址传进去 
    * baseminor：基础的次设备号  
    * coun：需要几个次设备号
    * name:字符设备的名字   


## unregister_chrdev_region 函数 释放设备  

* 定义在内核源文件的 char_dev.c 中

```c
void unregister_chrdev_region(dev_t from, unsigned count)
```

* 参数：
    * from：设备号  
    * count：要释放的数量  因为前面申请时可以连续申请多个设备  

## register_chrdev_region 注册字符设备并申请指定的设备号  

* 定义在内核源文件的 char_dev.c 中

```c
int register_chrdev_region(dev_t from, unsigned count, const char *name)
```

* 参数：
    * from: 指定的设备号











