

# 8.进程间通信—信号  

* 信号的特点  
    * 简单、不能携带大量信息、满足条件才发送  

    * 信号是软件层面上的“中断” (通常所说的中断是硬件帮助实现)。一旦信号产生，无论程序执行到什么位置，必须立即停止运行，处理信号，处理结束，再继续执行后续指令。

* **所有信号的产生及处理全部都是由内核完成的**

## 信号的概念  

**产生信号的方式**
* 1. 按键产生
    * 如 Crtl+c   Crtl+z（暂停，程序跑到后台，可以使用fg恢复）    Crtl+\ (终止进程，与Crtl+c效果相同但不是同一个信号)

* 2. 系统调用产生
    * 如kill   raise  abort
     
* 3. 软件条件产生
    * 定时器 alarm （sleep就是利用定时器实现的）  

* 4. 硬件异常产生
    * 非法访问内存(段错误)、除0(浮点数例外)、内存对齐出错(总线错误)  

* 5. 命令产生  
    * 如kill命令 

* **递达** ： 信号在内核产生并且送达到进程，就叫这个信号递达(递送到达)    直接被内核处理掉

* **未决** ： 产生与递达之间状态   主要由于阻塞(屏蔽)导致该状态  

* **信号处理方式**
    * 1.执行默认处理动作  每个信号都有他自己的处理动作 
    * 2.忽略  信号已经递达，内核处理它的方式是选择忽略     而未决是信号没到，所以内核无法处理  
    * 3.捕捉（自定义)  正常是每个信号都有默认的处理动作，捕捉就是捕捉一个信号，然后自定义处理方式  

* **阻塞信号集（信号屏蔽字）**：将某些信号加入集合，对他们设置屏蔽，当屏蔽某信号后，再收到该信号，该信号的处理将推后(解除屏蔽后)   也就是信号的阻塞看这个信号集
    * 本质：位图  用来记录信号的屏蔽状态。一旦被屏蔽的信号，在解除屏蔽前，一直处于未决态

* **未决信号集：
    * 1.信号产生，未决信号集中描述该信号的位立刻翻转为1，表示信号处于未决状态，当信号被处理后对应的为翻转为0， 这一时刻往往非常短暂   
    * 2.信号产生后，由于某些原因(主要是阻塞)不能递达； 这类信号的集合称之为未决信号集。 在屏蔽解除前，信号一直处于未决状态  
    * 本质：位图。用来记录信号的处理状态。该信号集中的信号，表示，已经产生，但尚未被处理。

* 阻塞信号集和未决信号集都在进程的PCB中  

* 如下图例子  
    * 当按键按下  Crtl+c后，未决信号集中对应位(2)置1， 对应的信号屏蔽字为0(默认都是0，说明没被阻塞)，内核会马上对其进行处理(上面提到了三种)，处理好后，内核负责把未决信号集对应位置0，这就完成了信号的产生和使用过程
    * 假如上面这个信号产生以后，由于某种原因，将其设置为屏蔽，信号屏蔽字对应位设置为1，表示其被阻塞，信号不能地递达，就不能处理，因此一直处于未决状态  需要等信号屏蔽字修改，解除屏蔽后，才能处理该信号，未决信号集对应位才可能翻转为0  

![image](https://user-images.githubusercontent.com/58176267/162742147-00d64f6e-424f-4d98-babb-55752badeba7.png)










