<p id="文件描述符"></p>  

# 文件描述符


一个a.out会有如下0-4G进程地址空间

![image](https://user-images.githubusercontent.com/58176267/159222872-595e5880-0774-4a18-bfc7-4a245a025140.png)

## PCB 进程控制块  

**PCB的本质是一个struct结构体**，具体可以从参照操作系统内容，里面有很多成员，其中一个是**文件描述符表**(一个指针，指向了文件描述符表)  

## 文件描述符表  

* **文件描述符表中的每个元素(文件描述符)是一个键值对映射**，其中value是一个指针，**指向一个文件结构体struct file**  
* 其中文件结构体是使用open(fopen)成功打开的文件  内容包括了文件打开的路径，状态，所有者等描述信息  
struct file
{
}  
* 之前使用open等返回的文件描述符，实际上是这里的key，根据它映射到了一个文件结构体指针，指向文件结构体  
* 操作系统将文件结构体指针和文件结构体进行了隐藏，只暴露下标  
* 上面的文件描述符表到底是一个指针数组还是其他数据结构？

* 文件描述符表中  
    * 下标0 对应的是stdin(标准输入)
    * 下标1对应stdout
    * 下标2对应stderr
    * 如果在程序中再打开一个文件，描述符就是3
    * 一个进程默认最多能打开的文件上限是1024个，所以最大是1023  这个值如果想改变需要重新编译内核  
    * 新打开的文件的描述符一定是描述符表中可用的最小值  如果打开一个为3，close后，再打开一个其文件描述符还是3  
    * 前三个在使用时尽量使用他们对应的宏而不是直接用数字




