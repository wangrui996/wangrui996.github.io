

# 1.网络层服务  

## 网络层提供的服务  

* 从发送主机向接收主机传送数据段(segment)  
* 发送主机：将数据段封装到数据报（datagram）中
* 接收主机：向传输层交付数据段(segment)  
* 网络层不再是端到端的协议，**每个**主机和**路由器**都运行网络层协议
* 路由器检验所有穿越它的IP数据报的头部域
    * 决策如何处理IP数据报  

![image](https://user-images.githubusercontent.com/58176267/161902057-360584d4-92f9-4e35-89c6-cebc10fc503f.png)

## 网络层核心功能

### 转发与路由  

**转发(forwarding)** ： 将分组从路由器的输入端口转移到合适的输出端口
    * 问题：对于路由器，传入端口收到上层的数据报后，怎样知道转发到哪个输出端口
    * **转发表**：转发表确定在本路由器如何转发分组  
  
**路由(routing)** : 确定分组从源到目的经过的路径
    * 路由器需要运行 路由算法
    * 路由协议/算法确定的路由信息，记录在转发表中，当路由器收到一个具体的数据报时，根据数据报地址信息，检索转发表完成转发  
    
![image](https://user-images.githubusercontent.com/58176267/161906015-324412a8-0825-41cc-ae7c-b6b107f99879.png)

### 连接建立  

* 并不是所有网络都需要网络层支持连接建立功能   
* 需要网络层具有连接建立的网络：
    * ATM、帧中继、X.25 (其中X.25 帧中继都比较过时)  
* 网络层的这个连接与TCP不同，经过的路径上的每一个网络层设备都要参与记录这个连接  
* TCP的连接只在端到端的系统记录连接信息，对于网络中的网络设备是透明的  

## 网络层服务模型  

* Internet中的网络层，使用的是一种 "best effort"  带宽、丢包率、数据的有序性、时延等网络层都无法保障   且不进行拥塞信息反馈等(如TCP协议不依靠网络层提供的拥塞信息来进行拥塞控制而是通过是否发生数据丢失推断)

* 如下图ATM（异步传输模式网络）, 在网络层提供的服务有4种
    * CBR 固定比特率传输  可以保障带宽，数据有序性、时延   也称为电路仿真，不需要拥塞控制
    * VBR 可用比特率   网络空闲时，可以更宽的比特率传输   

![image](https://user-images.githubusercontent.com/58176267/161908703-8da9e128-461f-43b9-abc8-a7ed6519569c.png)


### 网络层服务模型类型  

* **无连接服务**(connection-less service)
    * 不事先为一系列分组的传输确定传输路径   比如从源主机要向目的主机发送一系列的数据报，这些分组在网络中传输时，不需要事先为这些分组确定一条路径然后沿这条路径传输 与传输层所说的无连接相识？
    * 每个分组独立确定传输路径  由网络层设备如路由器根据当前网络状态选择不同路径进行传输
    * 也就是说，不同分组可能传输路径不同 (这也就是说，发送端按序的数据，由于网络中走的路径不同，到达目的主机的顺序也可能是不同的)  
    * **代表：数据报网络（datagram network）**

* **连接服务**(connection service)
    * 首先为一系列分组的传输确定从源到目录主机经过的路径(**建立连接**)
    * 从同一源主机发送的一系列分组都沿该路径（连接）传输到目的主机  
    * 这样就好像在源主机和目的主机之间建立起来一条电路连接(虚电路)
    * 分组经过的路径相同(分组的次序可以得到保障)  
    * 传输接收后拆除连接  
    * **代表：虚电路网络(virtual-circuit network)**








