

# 4.IP协议————IP数据报  

## IP协议  

![image](https://user-images.githubusercontent.com/58176267/162138193-ef71db6b-b626-4f1a-88d4-6c9d90a58d47.png)

### IP数据报/ IP分组 格式  

* 下图的格式是第4版IP协议中数据报格式  
* IP数据报  首部 + 数据
    * 首部：固定部分(该部分在所有IP数据报中都是固定大小，共20字节)   可变部分  
    * 数据

* **版本号** 4bit  IP协议的版本号   如IPv4对应4    IPv6对应6
* **首部长度** 4bit  IP分组首部长度(4个比特最大表示的数是15)，因此IP协议规定，该部分转换为10进制后，**是以4字节为单位(也就是一行)**  
    * 如该部分为5， 首部长度为 5 * 4 = 20 字节 
* **服务类型(TOS)**  8bit : 指示期望获得哪种类型的服务  1998年该字段改为**区分服务**  能够让网络层区分不同类型的IP数据报 
    * 如某些数据报可能优先转发  但该字段只有在网络提供区分服务(DiffServ)时才用作用 
    * 一般情况下不适用，IPv4分组的该字段(第2字节)的值为00H
* **总长度**字段  16bit ： IP分组的总字节数（首部加数据）
    * 最大IP分组的总长度：65535Byte 
    * 最小的IP分组首部： 20B
    * IP分组可以封装的最大数据：65515B
    * 实际系统中，不会用这么大的分组，需要切分
* 第二行三个字段与IP数据报的分片有关  
* **生存时间(TTL, time to live)**: 8bit : IP分组在网络中可以通过的路由器数(或跳步数)  
    * 路由器转发一次分组，TTL减1  
    * 如果TTL = 0，路由器则丢弃该IP分组、
    * 如果路由器丢弃一个分组，它会向源主机发送ICMP的一个报文 
* **协议** 8bit ： 指示IP分组封装的是哪个协议的数据报
    * 实现复用/分解   




![image](https://user-images.githubusercontent.com/58176267/162139650-a7eeb77c-c76d-40e2-95f7-5bed693db035.png)


