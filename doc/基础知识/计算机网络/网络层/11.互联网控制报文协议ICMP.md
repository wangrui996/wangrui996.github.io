# 互联网控制报文协议ICMP


网络层IP数据报错误时通常采取的措施是直接丢弃，但通常还需要通过ICMP向IP数据报的源主机发送ICMP报文进行差错报告

## 两类ICMP报文

### 1.差错报告报文
* 目的不可达
* 源抑制（Source Quench）：咋ICMP最初设计时，针对网络层的拥塞控制问题，当某个路由器发现自身缓存已满，导致后序到达的IP数据报会丢弃时，可构造源抑制的ICMP控制报文，向源主机发送，目的是期望源主机收到该报文后，降低其向网络中发送IP数据报的速度；**但现在实际网络中并没有按该种方式进行拥塞控制**
* 超时/超期： 典型的是 TTL超时(time to live) 定义了一个IP可以经过的路由器的最大数量  当路由器转发一个IP数据报时会将TTL减1，当TTL减到0时，路由器会丢弃该IP数据报，同时，会向源主机发送一个超时/超期的ICMP报文，报告差错
* 参数问题：路由器转发IP数据报时，如果认为其头部某些字段等有问题，可以丢弃，并向源主机发送ICMP报文
* 重定向(Redirect):  当某路由器收到一个IP数据报，该IP报所到达的目的网络，在路由器看来不应该由本路由器进行转发，应该由这个网络连接的另外一个默认网关或路由器进行转发，此时可以向源主机发送重定向的ICMP报文

### 2.网络探询报文(两组)

* 由主机或路由器主动发起ICMP报文

* 1.回声(Echo)请求和应答报文(Relay)   
    * **典型应用**： ping   
        * 通过发送echo请求报文，接收reply，进行网络探测
* 2.时间戳请求与应答报文  

![image](https://user-images.githubusercontent.com/58176267/170211192-e61e828b-48f8-498b-b509-b714c4a3a4a2.png)



