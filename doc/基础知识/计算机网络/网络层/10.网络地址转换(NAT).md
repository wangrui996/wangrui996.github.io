

# 10.网络地址转换/NAT  

* 上一小节讲了一个主机的IP怎样获取，很多时候是从DHCP服务器获取，DHCP是从一个ISP那申请的地址块，ISP从一个更大的ISP那申请地址块，再往上要通过一个国际组织进行分配  
* 问题是：IPv4的地址空间，去掉D,E类，剩下的A,B,C再去掉一些特殊地址，私有地址，剩下的可用于公共互联网的地址空间已经分配殆尽  
* 在实际网络通信中，经常有主机使用的是私有地址，这些私有地址是不能在公共互联网出现的，那么怎么保证具有这些IP地址的主机在互联网正常通信————NAT 网络地址转换  


## NAT  

* 如下图示例，本地网络 10.0.0/24是一个私有网络
* 该网络内主机向互联网发送的报文通过路由器的网络接口 10.0.0.4向外发送 
* 因此该路由器必须完成地址转换的功能  且该路由器至少拥有一个公共IP地址(合法IP)
* 该网络内的主机在内部相互通信，源和目的主机IP直接使用子网10.0.0/24内的地址即可  


* **注意：所有离开本地网络去往Internet的数据报的源IP地址都替换为相同的NAT IP地址 138.76.29.7 以及不同的端口号*
    * 也就是要不同端口号加以区分  

![image](https://user-images.githubusercontent.com/58176267/162868328-fda6f558-7456-4bf4-9f38-df3abf4550e1.png)



* 本地网络全部使用私有地址，IP变更无需通告外界(对外界透明)
* 变更ISP(如原先通过联通，现在通过电信接入)，内部网络设备的IP地址不需要修改  

![image](https://user-images.githubusercontent.com/58176267/162868788-80b2057a-1769-4523-bc6d-8dd92eb92c1f.png)

## NAT的实现  

