


# 8.CIDR与路由聚合  


## CIDR 无类域间路由  

* 将网络号和子网号统一成一个前缀，可以任意长度(消除了A，B，C类地址界限)  
* 融合子网地址和子网掩码  

* 图中的例子，如果按有类IP地址，是一个C类地址，网络号占24位，但是按CIDR，前缀占23位 主机号可以用9位   打破了有类地址的界限划分   

![image](https://user-images.githubusercontent.com/58176267/162711275-9c4c7b6c-872b-4245-ae0f-841779df3e34.png)


### 路由聚合  

* 利用CIDR可以将多个子网聚合成一个较大的子网，路由器的转发表可以面向更大的子网记录它的路由转发信息，而不是记录每一个小的子网  转发表的大小也能大幅减小 从而提高路由效率  
* 没有CIDR技术，只利用子网地址加子网掩码，也可以有类似路由聚集的效果？

![image](https://user-images.githubusercontent.com/58176267/162712234-5a970ed4-2fa8-40c4-b722-bd531868e48a.png)

![image](https://user-images.githubusercontent.com/58176267/162714267-aab4dfa8-1596-4c9c-aa26-a26f166cd9ca.png)

![image](https://user-images.githubusercontent.com/58176267/162714451-a3f25e1a-eb44-490e-b374-7782c4d4238c.png)



### 路由聚合示例  

* 左边共有8个子网，网络加子网号都是23位，对他们聚合，需要3bit来区分不同子网 因此
* 200.23.**0001**0000.00000000(200.23.16.0) 聚合后的IP地址，20位网络和子网号  ————> 到了这个大子网后 200.23.**0001000**0.00000000(200.23.16.0)、200.23.**0001001**0.00000000(200.23.18.0)、200.23.**0001010**0.00000000(200.23.20.0)、200.23.**0001011**0.00000000(200.23.22.0)、200.23.**0001100**0.00000000(200.23.24.0) 一直到  200.23.**0001111**0.00000000(200.23.30.0)

* 将这8个子网聚合成一个大的子网，向互联网发送IP分组时，以200.23.16.0/20为地址发送  
* 互联网中的一个IP数据报，如果目的IP地址的前20位满足与200.23.16.0/20的前20比特匹配，就可以向这个大的子网发送  

![image](https://user-images.githubusercontent.com/58176267/162735094-d825861d-2768-4152-861e-087f3b096117.png)


* 子网可以聚合为一个更大的子网的前提是：子网的地址空间是连续的，而且满足是2的幂次，由于互联网的发展，有可能会出现下面这种情况  
* 这样的话，某个发送到组织1(200.23018.0/23)的IP分组，应该是发送到下面那个ISP，现在却被发送到上面的那个ISP(路由黑洞现象)   
* 因此，**为了避免这种情况，同时又充分利用聚合的优点，顶层某些路由器路由就需要同时记录两个路由项，一个是满足200.23.16.0/20的IP分组，向上面的ISP发送，满足200.23.18.0/23的，向下面的发送**————**即最长前缀匹配优先策略** 

* 在充分使用路由聚合的同时，要关注在聚合的子网中是否缺少了某一部分子网，如果缺少了，那在同一个路由器中就需要不止一个路由项，通过前缀匹配的长度加以区分  

![image](https://user-images.githubusercontent.com/58176267/162735291-0e8eb81d-1a15-4f9f-9772-fe11680b7b7a.png)














