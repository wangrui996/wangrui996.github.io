# 生磁盘的使用  

* 所谓生磁盘是指通过盘块号访问磁盘， 熟磁盘是指通过文件访问磁盘  

* [磁盘的结构——B站视频演示](https://www.bilibili.com/video/BV1ET4y1w7De?spm_id_from=333.337.search-card.all.click)
* [磁盘的结构——CSDN](https://blog.csdn.net/weixin_46946895/article/details/108978100)
![image](https://user-images.githubusercontent.com/58176267/169259005-6ed7267b-80f2-4f1c-ab89-a7d565962f14.png)
![image](https://user-images.githubusercontent.com/58176267/169259067-fcfe12a2-42f0-4673-a085-e43ecb22c322.png)

![image](https://user-images.githubusercontent.com/58176267/169246036-490265e1-92c5-4828-86a7-aa9efa90f488.png)

![image](https://user-images.githubusercontent.com/58176267/169246288-7eb9aed3-0707-4491-b490-dc07b557a865.png)


* 移动磁头移动到磁道上,转动磁道移动到目标扇区   通过磁生电或者电生磁实现和内存缓冲区实现信息的交互

![image](https://user-images.githubusercontent.com/58176267/169247057-c38d838c-3c3d-4604-93d4-beebaf39631f.png)



## 直接使用磁盘的方式  

* 盘面、柱面、磁头、扇区、缓存位置的概念  
* 同一个盘面上不同磁道的扇区所占面积不同，最外圈要大，但是通过控制记录数据的密度，最终所有扇区容量是一致的,如512byte，4K 

* 最直接的使用磁盘的方式是将上面几个参数写到磁盘控制器上， 使用"out"指令————这是最后真正读写磁盘的操作  

![image](https://user-images.githubusercontent.com/58176267/169248272-5439e019-7a5c-4cc3-9005-a01576f4ccb5.png)


* 上述直接操作磁盘的方式太麻烦比如参数过多，操作系统进行抽象、封装  使用户使用磁盘变得简单(且高效)       复杂的东西可能不止抽象一层，这里也是的操作系统不止对磁盘做了一层抽象   

## 操作系统读写磁盘的第一层抽象————通过盘块号读写磁盘  

* 涉及到从一维地址到三维地址的编址过程   一个盘块号block————>三个参数  

![image](https://user-images.githubusercontent.com/58176267/169252223-683182e4-877c-438d-a89a-66c4bc1df1e6.png)

* 操作系统为了提高读写效率，使block相邻的盘块能快速读写，采用了图示的编址方式上
    * 因为实际使用时，某段时间内很可能是某个进程一直使用某一段连续的盘块号，而磁盘读写对速度影响最大的是寻道
* 编址方式确定后，就能根据盘块号得到C、H、S也可以根据C、H、S得到盘块号 
* 同时操作系统为进一步提高读写磁盘的效率扇区到盘块，将每一次读写的单位变大，上层用户发出的是盘块号，一个盘块号可以是连续的几个扇区
    * 这样操作会浪费一定的空间(有碎片)，因为即时只有很小一部分数据，一次也是读一个盘块(好几个扇区)的内容; 如图，每个扇区包含数据越大，每个盘块包含的扇区越多，实际上空间利用率越低，但是时间上会有提升; 由于机械硬盘容量在不断提升但是转速等没有本质提升，因此这里操作系统是采用空间换时间的做法  

 
![image](https://user-images.githubusercontent.com/58176267/169261721-0bd4cd4f-7dfd-4e38-a03b-5bb9c689eb6d.png)

* 以上是第一层抽象 通过这层抽象，可以直接通过盘块号读写磁盘，且每个盘块号对应的扇区数是已知的(**每个盘块号对应的扇区数是操作系统根据机械硬盘的参数设定的吗？**)
* 使用磁盘的方式：处理程序输出的block号  

* linux0.11代码中，sector扇区号等于盘块号右移一位得到的，因此一个盘块号对应两个扇区
    * 盘块号0———扇区0  盘块号1————扇区2  盘块号2————扇区4  盘块号3————扇区6   

![image](https://user-images.githubusercontent.com/58176267/169262924-45b77213-3c5f-411a-bbc4-2bc4ab21884d.png)


## 操作系统读写磁盘的第二层抽象————多进程通过队列使用磁盘  

![image](https://user-images.githubusercontent.com/58176267/169269345-e57f42b1-60e8-4d81-a726-6f826cda55ac.png)




