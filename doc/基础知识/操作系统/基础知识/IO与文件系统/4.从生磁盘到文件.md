# 4.从生磁盘到文件  


## 操作系统对磁盘使用的第三层抽象  

* **明确这次抽象的目的：希望从文件 得到 盘块号**  
    * 用户眼中的文件是字符序列，字符流 因此，任务是 如何根据字符流计算出它属于哪一个盘块  
* **核心： 建立字符流到盘块集合的映射关系**  

![image](https://user-images.githubusercontent.com/58176267/171355623-26756ddc-df0a-4642-b4be-96d09cc2e71e.png)


* 这种映射结构，可以用多种方案实现，如连续结构实现  一旦确定后，就能根据一个数字范围唯一确定一个盘块  
    * 比如下图中，假设0-99字节放在6号盘块，100-199放在7号盘块 200-212属于200-299之间，所以在8号盘块  
    * 一旦给出如200-212这种值，就能根据一个盘块存放多少数据，计算出属于哪个盘块，对于linux0.11来说，一个盘块是2个扇区，1K字节
* 对于连续结构来说，对于映射表，需要存放：
    * 用户输入的200，要根据200/100(2) + 6(初始盘块)得到8  这里的100是已知的，对于test.c，表中需要存放数字6，即第一个块的块号，**存放在这个表对应的一个数据结构 FCB**   
* 对于一个文件，有了这个FCB数据结构，这张表，对于用户输入的任意一个数字，即要处理的第几个字符，通过简单的公式就可以计算出这个字符所在盘块，公式中需要的值如一个盘块的字节数是初始化好的，起始块是查表得到的。

![image](https://user-images.githubusercontent.com/58176267/171359111-a1b13c72-620e-42c7-8f5c-22dd036fa987.png)


